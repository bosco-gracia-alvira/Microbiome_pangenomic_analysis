---
title: "05.SNPs_analysis"
author: "Bosco Gracia Alvira"
date: "2024-07-25"
output: html_document
---

```{r setup}
knitr::opts_knit$set(root.dir = "/Users/bgracia/PopGen Dropbox/Martin McFly/Bosco/PhD_Dropbox/Microbiome_pangenomic_analysis/data/Lactiplantibacillus_plantarum/SNPs_analysis")
knitr::opts_chunk$set(echo = FALSE)
library(lattice)
library(data.table)
library(Biostrings)
library(ggplot2)
library(dplyr)
library(tidyverse)
library(stringr)
library(gtools)

```



```{r Loading the data}

# Paths to the files that we want to import
data_path <- "/Users/bgracia/PopGen Dropbox/Martin McFly/Bosco/PhD_Dropbox/Microbiome_pangenomic_analysis/data/Lactiplantibacillus_plantarum/SNPs_analysis"
metadata_isolates_path <- "/Users/bgracia/PopGen Dropbox/Martin McFly/Bosco/PhD_Dropbox/Microbiome_pangenomic_analysis/data/Lactiplantibacillus_plantarum/Anvio/Anvio_misc.tsv"
visuals_path <- "/Users/bgracia/PopGen Dropbox/Martin McFly/Bosco/PhD_Dropbox/Microbiome_pangenomic_analysis/visuals"

pca <- read.table(paste0(data_path,"/Lactiplantibacillus_plantarum.eigenvec"),sep=" ",header=F)
colnames(pca)[1] <- "name"
pca[,2] <- NULL

metadata_isolates <- fread(metadata_isolates_path, header=T)
metadata_isolates$Source <- "Isolate"

           
metadata_pools <- as.data.frame(pca$name[grepl("^cF|^hF", pca$name)])
colnames(metadata_pools) <- "name"
metadata_pools <- metadata_pools %>%
  mutate(
    Temperature = case_when(
      str_detect(name, "F0") ~ "BASE",
      str_detect(name, "^h") ~ "HOT",
      str_detect(name, "^c") ~ "COLD"),
    Generation = str_extract(name, "F\\d+"),
    Source = "Pool")

metadata <- rbind(metadata_isolates,metadata_pools)

# Create a colour palette for our temperatures
temp_palette <- c("HOT" = "red", "BASE" = "grey", "COLD" = "lightblue")

```


```{r PCA of the SNPs}

pca_merged <- merge(pca, metadata, by = "name")

ggplot(pca_merged, aes(x = V3, y = V4, color = Temperature)) +
  geom_point(aes(shape=Source)) +
  labs(x = "PC1", y = "PC2", color = "Temperature", shape="Source") +
  scale_colour_manual(values = c("HOT" = "red", "BASE" = "grey", "COLD" = "lightblue", "COLD-CONSTANT" = "blue")) +
  theme_minimal()
ggsave(filename = paste0(visuals_path,"/Lpla_SNPs_PCA.png"), width = 6, height = 4, dpi = 300)

```



```{r Nucleotide diversity}






```




```{r Tajima's D}








```

